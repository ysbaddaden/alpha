<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="fr">
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
</head>
<body>

  <script type="text/javascript" src="jsunit.js"></script>
  <script type="text/javascript" src="../compat/array.js"></script>
  <script type="text/javascript" src="../compat/core.js"></script>
  <script type="text/javascript" src="../compat/events.js"></script>
  <script type="text/javascript" src="../compat/element.js"></script>

<script type="text/javascript">

function new_input()
{
  var input = document.createElement('input');
  document.body.appendChild(input);

  input.destroy = function() {
    this.parentNode.removeChild(this);
  }

  return input;
}

var _event_type = misago.browser.ie ? 'click' : 'focus';


jsUnit.add("Event must be prototyped", function() {
  jsUnit.assertObject(Event.prototype);
});

jsUnit.add("window.addEventListener must be defined", function() {
  jsUnit.assertFunction(window.addEventListener);
});
jsUnit.add("document.body.addEventListener must be defined", function() {
  jsUnit.assertFunction(document.body.addEventListener);
});
jsUnit.add("document.documentElement.addEventListener must be defined", function() {
  jsUnit.assertFunction(document.documentElement.addEventListener);
});

jsUnit.add("elm.addEventListener with one listener", function()
{
  var elm  = new_input();
  var test = null;

  elm.addEventListener(_event_type, function(evt) {
    test = true;
  }, false);

  elm[_event_type]();
  jsUnit.assertTrue(test);
  
  elm.removeNode();
});

jsUnit.add("elm.addEventListener with many listeners", function()
{
  var elm  = new_input();
  var test = null;

  elm.addEventListener(_event_type, function(evt) {
    test = true;
  }, false);

  elm.addEventListener(_event_type, function(evt) {
    test = false;
  }, false);

  elm[_event_type]();
  jsUnit.assertFalse(test);

  elm.removeNode();
});

jsUnit.add("elm.removeEventListener", function()
{
  var elm  = new_input();
  var test = null;

  var fn = function() {
    test = true;
  }

  elm.addEventListener(_event_type, fn, false);
  elm.removeEventListener(_event_type, fn, false);

  elm[_event_type]();
  jsUnit.assertNull(test);

  elm.removeNode();
});

if (Element.prototype.clearEvents)
{
  jsUnit.add("elm.clearEvents", function()
  {
    var elm  = new_input();
    var test = null;

    elm.addEventListener(_event_type, function() {
      test = true;
    }, false);
    elm.addEventListener(_event_type, function() {
      test = false;
    }, false);
    
    elm.clearEvents();

    elm[_event_type]();
    jsUnit.assertNull(test);

    elm.removeNode();
  });
}

jsUnit.run();

</script>

</body>
</html>
